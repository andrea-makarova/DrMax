<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Move &amp; Mind</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/2c7f1c6cae.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    :root {
      --blue-25: #f5f8fd;
      --blue-50: #e5f1fe;
      --blue-200: #95ccfe;
      --blue-400: #3997dd;
      --blue-500: #0d77ba;
      --gray-50: #f1f1f1;
      --gray-100: #e2e2e2;
      --gray-300: #ababab;
      --gray-400: #919191;
      --gray-900: #1b1b1b;
      --green-300: #78be20;
      --green-500: #47850a;
      --red-500: #e4002b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--blue-25);
      font-family: "Proxima Vara", "Proxima Nova", "Figtree", system-ui, -apple-system, sans-serif;
      color: var(--gray-900);
    }
    .font-sans {
      font-family: "Proxima Vara", "Proxima Nova", "Figtree", system-ui, -apple-system, sans-serif !important;
    }
    .page {
      max-width: 1080px;
      margin: 0 auto;
      padding: 40px 24px 140px;
    }
    .top-nav {
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 12px;
    }
    .back-btn {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 1px solid #e5e5ea;
      background: #ffffff;
      display: grid;
      place-items: center;
      box-shadow: 0 6px 14px rgba(0,0,0,0.06);
      cursor: pointer;
    }
    .back-btn:active { transform: translateY(1px); }
    .glass {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.8);
      border-radius: 24px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.12);
      backdrop-filter: blur(10px);
    }
    .card { padding: 20px; }
    .stamps-card {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      min-height: 170px;
      border: 1px solid #e5e5ea;
      border-radius: 18px;
      background: #ffffff;
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.06);
    }
    .stamps-title {
      font-size: 14px;
      font-weight: 700;
      color: #3a3a3c;
      margin: 0 10px 0 0;
      white-space: nowrap;
    }
    .stamps-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px 10px;
      width: 100%;
      align-items: center;
      justify-items: center;
    }
    .stamp-dot {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 2px dashed #d7dce5;
      background: #f7f8fb;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #c0c4ce;
      font-size: 18px;
      position: relative;
      overflow: visible;
    }
    .stamp-icon {
      font-size: 18px;
      color: #2f6f0a;
    }
    .stamp-dot-filled {
      border-color: #5da20a;
      border-style: solid;
      background: linear-gradient(180deg, #eaf6dc 0%, #d8efbb 100%);
      box-shadow: 0 6px 14px rgba(93, 162, 10, 0.25);
      color: #2f6f0a;
    }
    .stamp-dot-disabled {
      border-style: solid;
      background: #f1f2f6;
    }
    .stamp-gift-active {
      border: none;
      background: linear-gradient(180deg, #95DA39 0%, #5DA20A 100%);
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(93,162,10,0.25);
    }
    .stamp-pop {
      animation: stampBounce 0.55s cubic-bezier(0.2, 0.9, 0.3, 1.2);
    }
    .bonus-card-pop {
      animation: bonusPop 0.9s cubic-bezier(0.25, 0.8, 0.3, 1) forwards;
      box-shadow: none;
    }
    .rewards-carousel {
      display: flex;
      gap: 12px;
      padding: 0 24px 16px;
      margin: 0 -24px;
      scroll-snap-type: x mandatory;
      scroll-padding: 0 24px;
      overflow-x: auto;
      overflow-y: visible;
      position: relative;
    }
    .rewards-carousel.reveal-card {
      overflow: visible !important;
      z-index: 4;
    }
    .rewards-carousel.scrolling-to-start {
      position: relative;
      overflow: visible !important;
    }
    .rewards-carousel.scrolling-to-start::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: linear-gradient(90deg, rgba(13,111,184,0.08), rgba(13,111,184,0));
      animation: scrollSweep 1.3s ease-out;
    }
    .stamps-card {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      min-height: 170px;
      border: 1px solid #e5e5ea;
      border-radius: 18px;
      background: #ffffff;
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.06);
      transform-style: preserve-3d;
    }
    .stamps-card.turning {
      animation: stampTurn 0.85s ease-in-out;
    }
    .bonus-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .bonus-modal.visible {
      display: flex;
    }
    .bonus-modal__overlay {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.45);
      backdrop-filter: blur(4px);
    }
    .bonus-modal__content {
      position: relative;
      z-index: 1;
      max-width: 480px;
      width: 90%;
      border-radius: 24px;
      padding: 28px 24px;
      text-align: center;
      box-shadow: 0 22px 48px rgba(15,23,42,0.18);
      animation: modalLift 0.45s ease-out;
    }
    .celebrate-icon {
      width: 84px;
      height: 84px;
      border-radius: 24px;
      margin: 0 auto 16px;
      background: linear-gradient(135deg, #95DA39 0%, #5DA20A 100%);
      display: grid;
      place-items: center;
      color: #ffffff;
      animation: iconPulse 1.4s ease-in-out infinite;
      position: relative;
      overflow: visible;
    }
    .celebrate-icon::after {
      content: "";
      position: absolute;
      inset: -10px;
      border-radius: 32px;
      border: 2px solid rgba(255,255,255,0.35);
      animation: iconRing 1.4s ease-in-out infinite;
    }
    .bonus-modal h3 {
      margin: 0 0 8px 0;
      font-size: 22px;
      font-weight: 800;
      color: #2f2f35;
    }
    .bonus-modal p {
      margin: 0 0 16px 0;
      color: #6e6e73;
      font-size: 14px;
      line-height: 20px;
    }
    .bonus-close {
      margin-top: 16px;
      background: #e5f1fe;
      color: #0d6fb8;
      border: 1px solid #cbdcf6;
      border-radius: 999px;
      padding: 12px 18px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      min-width: 160px;
      box-shadow: 0 6px 16px rgba(13, 111, 184, 0.16);
      transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms ease;
    }
    .bonus-close:hover { filter: brightness(0.98); box-shadow: 0 10px 20px rgba(13, 111, 184, 0.18); }
    .bonus-close:active { transform: translateY(1px); box-shadow: 0 6px 16px rgba(13, 111, 184, 0.16); }
    .bonus-code {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: #f5f8fd;
      color: #0d6fb8;
      border: 1px solid #d7dce5;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 800;
      letter-spacing: 0.6px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.8);
    }
    .bonus-code i { color: #0d6fb8; font-size: 14px; }
    .confetti-piece {
      position: fixed;
      width: 8px;
      height: 14px;
      border-radius: 3px;
      opacity: 0.95;
      pointer-events: none;
      animation: confettiFall 1.2s ease-out forwards;
    }
    .confetti-piece {
      position: fixed;
      width: 8px;
      height: 14px;
      border-radius: 3px;
      opacity: 0.95;
      pointer-events: none;
      animation: confettiFall 1.2s ease-out forwards;
    }
    @keyframes stampBounce {
      0% { transform: translateY(-12px) scale(0.9); box-shadow: 0 0 0 rgba(93,162,10,0); opacity: 0.85; }
      40% { transform: translateY(8px) scale(1.15); box-shadow: 0 16px 28px rgba(93,162,10,0.32); opacity: 1; }
      70% { transform: translateY(-6px) scale(1.02); box-shadow: 0 10px 20px rgba(93,162,10,0.24); }
      100% { transform: translateY(0) scale(1); box-shadow: 0 8px 18px rgba(93,162,10,0.18); opacity: 1; }
    }
@keyframes bonusPop {
  0% { transform: translateY(18px) scale(0.96); box-shadow: none; opacity: 0; }
  55% { transform: translateY(-4px) scale(1.02); box-shadow: none; opacity: 1; }
  100% { transform: translateY(0) scale(1); box-shadow: none; opacity: 1; }
}
    @keyframes scrollSweep {
      0% { transform: translateX(-12%); opacity: 0.55; }
      100% { transform: translateX(100%); opacity: 0; }
    }
    @keyframes stampTurn {
      0% { transform: rotateY(0deg) scale(1); opacity: 1; }
      40% { transform: rotateY(75deg) scale(0.96); opacity: 0.5; }
      60% { transform: rotateY(100deg) scale(0.96); opacity: 0.4; }
      100% { transform: rotateY(0deg) scale(1); opacity: 1; }
    }
    @keyframes confettiFall {
      0% { transform: translate3d(var(--x, 0px), -10px, 0) rotate(0deg); opacity: 1; }
      100% { transform: translate3d(var(--x, 0px), 140px, 0) rotate(420deg); opacity: 0; }
    }
    @keyframes modalLift {
      0% { transform: translateY(14px) scale(0.97); opacity: 0; }
      100% { transform: translateY(0) scale(1); opacity: 1; }
    }
    @keyframes iconPulse {
      0%, 100% { transform: scale(0.95); }
      50% { transform: scale(1.06); }
    }
    @keyframes iconRing {
      0% { transform: scale(0.9); opacity: 0.7; }
      100% { transform: scale(1.1); opacity: 0; }
    }
    .tabbar {
      position: fixed;
      bottom: 0px;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 1px solid #ededed;
      display: grid;
  grid-template-columns: repeat(5, 1fr);
      padding: 16px 8px 16px;
      box-shadow: 0 -10px 24px rgba(0, 0, 0, 0.05);
      z-index: 999;
    }
    .tab {
      display: grid;
      place-items: center;
      gap: 2px;
      font-size: 12px;
      color: #8e8e93;
      text-decoration: none;
    }
    .tab-icon {
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .tab-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      filter: grayscale(1) brightness(0.8);
    }
    .tab.active { color: var(--green-500); font-weight: 700; }
    .tab:not(.active) { color: #8e8e93; }
    .tab.active .tab-icon img { filter: none; }
    .section-title { font-size: 20px; font-weight: 700; margin: 0; color: var(--gray-900); }
    .muted { color: var(--gray-400); font-size: 14px; }
    .bar {
      height: 10px;
      border-radius: 999px;
      background: var(--blue-50);
      overflow: hidden;
    }
    .bar-fill {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(90deg, var(--green-300), var(--green-500));
    }
    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--blue-50);
      color: var(--gray-900);
      font-size: 12px;
      font-weight: 600;
      border: 1px solid var(--gray-100);
    }
    .challenge {
      margin-top: 18px;
      padding: 14px 16px;
      border-radius: 16px;
      background: rgba(13, 119, 186, 0.06);
      border: 1px solid #e5f1fe;
      color: #0d6fb8;
      font-size: 16px;
      line-height: 22px;
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.05);
      max-width: 520px;
      width: 100%;
    }
    .challenge strong { color: #0d6fb8; }
    .challenge button {
      margin-top: 10px;
      background:#47850a;
      color:#ffffff;
      border:1px solid #47850a;
      border-radius:999px;
      padding:10px 16px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 6px 14px rgba(53,107,9,0.18);
    }
    .challenge button:active { transform: translateY(1px); }
    .card-header-safe { position: relative; }
    .main-half-lock {
      position: absolute;
      inset: 35% 0 0 0;
      display: flex;
      align-items: flex-end;
      justify-content: flex-start;
      background: rgba(255,255,255,0.82);
      backdrop-filter: blur(8px);
      pointer-events: all;
      padding: 16px 24px 18px;
    }
    @media (max-width: 400px) {
      .card-tag {
        position: static !important;
        margin-top: 8px !important;
        align-self: flex-start !important;
      }
    }
    @keyframes breathe {
      0% { transform: scale(0.9); opacity: 0.7; }
      50% { transform: scale(1.05); opacity: 1; }
      100% { transform: scale(0.9); opacity: 0.7; }
    }
  </style>
</head>
<body>
  <main class="page">
    <div class="top-nav">
      <button class="back-btn" onclick="window.location.href='app-home.html'" aria-label="Back">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M14.5 5L8.5 11.5L14.5 18" stroke="#1b1b1b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <section style="padding:20px 0px 28px;margin-bottom:24px;">
      
      <div style="display:flex;flex-direction:column;align-items:flex-start;gap:12px;text-align:left;">
        <div style="width:120px;height:120px;position:relative;flex-shrink:0;">
          <svg xmlns="http://www.w3.org/2000/svg" width="88" height="88" viewBox="0 0 88 88" fill="none">
<path d="M44.9279 59.5715C44.8309 54.0181 46.8772 48.6548 50.6165 44.6615C54.3558 40.6682 59.4819 38.3719 64.867 38.2779C70.2521 38.1839 75.4551 40.2999 79.3315 44.1603C83.2079 48.0206 85.4401 53.3092 85.5371 58.8626C85.634 64.416 83.5877 69.7793 79.8484 73.7726C76.1091 77.7659 70.9831 80.0622 65.598 80.1562C60.2128 80.2502 55.0098 78.1342 51.1334 74.2739C47.257 70.4135 45.0248 65.1249 44.9279 59.5715ZM69.7466 47.9382C68.9181 47.3418 67.7906 47.3906 67.0124 48.0587L55.8945 57.5619C55.1578 58.1856 54.88 59.2378 55.2205 60.1627C55.5611 61.0877 56.418 61.6982 57.3768 61.6815L62.0159 61.6005L59.8815 67.805C59.546 68.7854 59.8896 69.8849 60.7184 70.4959C61.5471 71.1069 62.6744 71.0435 63.4526 70.3754L74.5705 60.8722C75.3071 60.2485 75.585 59.1964 75.2444 58.2714C74.9039 57.3464 74.0469 56.7359 73.0881 56.7527L68.4491 56.8336L70.5834 50.6291C70.9189 49.6487 70.5753 48.5492 69.7466 47.9382Z" fill="url(#paint0_linear_49145_52454)"/>
<path d="M37.5065 14.1882L39.6741 17.1613L41.7366 14.1144C45.1739 9.02162 50.7902 5.94176 56.8111 5.83666C67.1749 5.65576 75.7301 14.1755 75.9166 24.8632L75.9232 25.2413C75.9679 27.8005 75.5342 30.4263 74.72 33.0732C71.6242 31.8763 68.2562 31.2369 64.7452 31.2982C49.7987 31.5591 37.8906 44.2761 38.1597 59.6896C38.232 63.8338 39.175 67.7592 40.8162 71.2796C40.7457 71.2809 40.6893 71.2818 40.6188 71.2831C38.4332 71.3212 36.2642 70.69 34.5057 69.3389C24.0711 61.4192 4.01385 42.8165 3.72907 26.5014L3.72247 26.1234C3.53592 15.4357 11.7885 6.62254 22.1523 6.44164C28.1732 6.33654 33.8936 9.21852 37.5065 14.1882Z" fill="url(#paint1_linear_49145_52454)"/>
<defs>
<linearGradient id="paint0_linear_49145_52454" x1="44.9279" y1="59.5715" x2="85.5371" y2="58.8626" gradientUnits="userSpaceOnUse">
<stop stop-color="#E4002B"/>
<stop offset="1" stop-color="#FD5553"/>
</linearGradient>
<linearGradient id="paint1_linear_49145_52454" x1="39.4817" y1="6.13915" x2="40.6188" y2="71.2831" gradientUnits="userSpaceOnUse">
<stop stop-color="#95DA39"/>
<stop offset="1" stop-color="#5DA20A"/>
</linearGradient>
</defs>
</svg>
        </div>
        <div>
          <p style="margin:0;font-size:32px;font-weight:800;line-height:40px;color:#333;">Welcome back. Keep on moving.</p>
        </div>
      </div>
      <div class="stamps-card" style="margin-top:40px;">
        <div class="stamps-row" aria-label="Stamp progress">
          <span class="stamp-dot"></span>
          <span class="stamp-dot"></span>
          <span class="stamp-dot"></span>
          <span class="stamp-dot"></span>
          <span class="stamp-dot"></span>
          <span class="stamp-dot"></span>
          <span class="stamp-dot"></span>
          <span class="stamp-dot stamp-dot-disabled" aria-label="Reward locked">
            <i class="fa-solid fa-gift" style="font-size:18px;color:#c0c4ce;"></i>
          </span>
        </div>
      </div>
    </section>

    <section class="mb-12">
      <h2 class="section-title" style="font-size:20px;margin-bottom:16px;">Your Rewards</h2>
      <div class="rewards-carousel">
        <!-- Daily steps stamp rewards -->
        <div class="reward-card font-sans" data-reward-type="stamp" data-stamp-date="Apr 18" data-reward-code="MOVE10" style="flex:0 0 240px; background: linear-gradient(180deg, #8ed63a 0%, #5ca80a 100%); border-radius: 24px; padding: 22px 18px; color: #ffffff; box-shadow: none; scroll-snap-align:start; margin-bottom:10px;">
          <div style="display:flex;align-items:center;justify-content:center;margin-bottom:16px;">
            <div style="width:64px;height:64px;border-radius:50%;background:#ffffff;display:flex;align-items:center;justify-content:center;">
              <i class="fa-solid fa-shoe-prints reward-main-icon" style="font-size:28px;color:#2f6f0a;background:linear-gradient(135deg,#95DA39 0%,#2f6f0a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;"></i>
            </div>
          </div>
          <div style="text-align:center; margin-bottom:18px;">
            <p class="reward-title" style="margin:0 0 2px 0; font-size:18px; font-weight:700; line-height:22px;">Daily Steps</p>
            <p class="reward-description" style="margin:0; font-size:14px; font-weight:600; line-height:18px;">Apr 18</p>
          </div>
          <div style="display:flex;justify-content:center;">
            <button style="background:#ffffff;color:#0d6fb8;border:none;border-radius:999px;padding:10px 22px;font-size:16px;font-weight:700;cursor:pointer;min-width:170px;text-align:center;">Redeem stamp</button>
          </div>
        </div>
        <div class="reward-card font-sans" data-reward-type="stamp" data-stamp-date="Apr 17" data-reward-code="MOVE10" style="flex:0 0 240px; background: linear-gradient(180deg, #8ed63a 0%, #5ca80a 100%); border-radius: 24px; padding: 22px 18px; color: #ffffff; box-shadow: none; scroll-snap-align:start; margin-bottom:10px;">
          <div style="display:flex;align-items:center;justify-content:center;margin-bottom:16px;">
            <div style="width:64px;height:64px;border-radius:50%;background:#ffffff;display:flex;align-items:center;justify-content:center;">
              <i class="fa-solid fa-shoe-prints reward-main-icon" style="font-size:28px;color:#2f6f0a;background:linear-gradient(135deg,#95DA39 0%,#2f6f0a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;"></i>
            </div>
          </div>
          <div style="text-align:center; margin-bottom:18px;">
            <p class="reward-title" style="margin:0 0 2px 0; font-size:18px; font-weight:700; line-height:22px;">Daily Steps</p>
            <p class="reward-description" style="margin:0; font-size:14px; font-weight:600; line-height:18px;">Apr 17</p>
          </div>
          <div style="display:flex;justify-content:center;">
            <button style="background:#ffffff;color:#0d6fb8;border:none;border-radius:999px;padding:10px 22px;font-size:16px;font-weight:700;cursor:pointer;min-width:170px;text-align:center;">Redeem stamp</button>
          </div>
        </div>
        <div class="reward-card font-sans" data-reward-type="stamp" data-stamp-date="Apr 16" data-reward-code="MOVE10" style="flex:0 0 240px; background: linear-gradient(180deg, #8ed63a 0%, #5ca80a 100%); border-radius: 24px; padding: 22px 18px; color: #ffffff; box-shadow: none; scroll-snap-align:start; margin-bottom:10px;">
          <div style="display:flex;align-items:center;justify-content:center;margin-bottom:16px;">
            <div style="width:64px;height:64px;border-radius:50%;background:#ffffff;display:flex;align-items:center;justify-content:center;">
              <i class="fa-solid fa-shoe-prints reward-main-icon" style="font-size:28px;color:#2f6f0a;background:linear-gradient(135deg,#95DA39 0%,#2f6f0a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;"></i>
            </div>
          </div>
          <div style="text-align:center; margin-bottom:18px;">
            <p class="reward-title" style="margin:0 0 2px 0; font-size:18px; font-weight:700; line-height:22px;">Daily Steps</p>
            <p class="reward-description" style="margin:0; font-size:14px; font-weight:600; line-height:18px;">Apr 16</p>
          </div>
          <div style="display:flex;justify-content:center;">
            <button style="background:#ffffff;color:#0d6fb8;border:none;border-radius:999px;padding:10px 22px;font-size:16px;font-weight:700;cursor:pointer;min-width:170px;text-align:center;">Redeem stamp</button>
          </div>
        </div>
        <div class="reward-card font-sans" data-reward-type="stamp" data-stamp-date="Apr 15" data-reward-code="MOVE10" style="flex:0 0 240px; background: linear-gradient(180deg, #8ed63a 0%, #5ca80a 100%); border-radius: 24px; padding: 22px 18px; color: #ffffff; box-shadow: none; scroll-snap-align:start; margin-bottom:10px;">
          <div style="display:flex;align-items:center;justify-content:center;margin-bottom:16px;">
            <div style="width:64px;height:64px;border-radius:50%;background:#ffffff;display:flex;align-items:center;justify-content:center;">
              <i class="fa-solid fa-shoe-prints reward-main-icon" style="font-size:28px;color:#2f6f0a;background:linear-gradient(135deg,#95DA39 0%,#2f6f0a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;"></i>
            </div>
          </div>
          <div style="text-align:center; margin-bottom:18px;">
            <p class="reward-title" style="margin:0 0 2px 0; font-size:18px; font-weight:700; line-height:22px;">Daily Steps</p>
            <p class="reward-description" style="margin:0; font-size:14px; font-weight:600; line-height:18px;">Apr 15</p>
          </div>
          <div style="display:flex;justify-content:center;">
            <button style="background:#ffffff;color:#0d6fb8;border:none;border-radius:999px;padding:10px 22px;font-size:16px;font-weight:700;cursor:pointer;min-width:170px;text-align:center;">Redeem stamp</button>
          </div>
        </div>
        <div class="reward-card font-sans" data-reward-type="stamp" data-stamp-date="Apr 14" data-reward-code="MOVE10" style="flex:0 0 240px; background: linear-gradient(180deg, #8ed63a 0%, #5ca80a 100%); border-radius: 24px; padding: 22px 18px; color: #ffffff; box-shadow: none; scroll-snap-align:start; margin-bottom:10px;">
          <div style="display:flex;align-items:center;justify-content:center;margin-bottom:16px;">
            <div style="width:64px;height:64px;border-radius:50%;background:#ffffff;display:flex;align-items:center;justify-content:center;">
              <i class="fa-solid fa-shoe-prints reward-main-icon" style="font-size:28px;color:#2f6f0a;background:linear-gradient(135deg,#95DA39 0%,#2f6f0a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;"></i>
            </div>
          </div>
          <div style="text-align:center; margin-bottom:18px;">
            <p class="reward-title" style="margin:0 0 2px 0; font-size:18px; font-weight:700; line-height:22px;">Daily Steps</p>
            <p class="reward-description" style="margin:0; font-size:14px; font-weight:600; line-height:18px;">Apr 14</p>
          </div>
          <div style="display:flex;justify-content:center;">
            <button style="background:#ffffff;color:#0d6fb8;border:none;border-radius:999px;padding:10px 22px;font-size:16px;font-weight:700;cursor:pointer;min-width:170px;text-align:center;">Redeem stamp</button>
          </div>
        </div>
        <div class="reward-card font-sans" data-reward-type="stamp" data-stamp-date="Apr 13" data-reward-code="MOVE10" style="flex:0 0 240px; background: linear-gradient(180deg, #8ed63a 0%, #5ca80a 100%); border-radius: 24px; padding: 22px 18px; color: #ffffff; box-shadow: none; scroll-snap-align:start; margin-bottom:10px;">
          <div style="display:flex;align-items:center;justify-content:center;margin-bottom:16px;">
            <div style="width:64px;height:64px;border-radius:50%;background:#ffffff;display:flex;align-items:center;justify-content:center;">
              <i class="fa-solid fa-shoe-prints reward-main-icon" style="font-size:28px;color:#2f6f0a;background:linear-gradient(135deg,#95DA39 0%,#2f6f0a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;"></i>
            </div>
          </div>
          <div style="text-align:center; margin-bottom:18px;">
            <p class="reward-title" style="margin:0 0 2px 0; font-size:18px; font-weight:700; line-height:22px;">Daily Steps</p>
            <p class="reward-description" style="margin:0; font-size:14px; font-weight:600; line-height:18px;">Apr 13</p>
          </div>
          <div style="display:flex;justify-content:center;">
            <button style="background:#ffffff;color:#0d6fb8;border:none;border-radius:999px;padding:10px 22px;font-size:16px;font-weight:700;cursor:pointer;min-width:170px;text-align:center;">Redeem stamp</button>
          </div>
        </div>
        <div class="reward-card font-sans" data-reward-type="stamp" data-stamp-date="Apr 12" data-reward-code="MOVE10" style="flex:0 0 240px; background: linear-gradient(180deg, #8ed63a 0%, #5ca80a 100%); border-radius: 24px; padding: 22px 18px; color: #ffffff; box-shadow: none; scroll-snap-align:start; margin-bottom:10px;">
          <div style="display:flex;align-items:center;justify-content:center;margin-bottom:16px;">
            <div style="width:64px;height:64px;border-radius:50%;background:#ffffff;display:flex;align-items:center;justify-content:center;">
              <i class="fa-solid fa-shoe-prints reward-main-icon" style="font-size:28px;color:#2f6f0a;background:linear-gradient(135deg,#95DA39 0%,#2f6f0a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;"></i>
            </div>
          </div>
          <div style="text-align:center; margin-bottom:18px;">
            <p class="reward-title" style="margin:0 0 2px 0; font-size:18px; font-weight:700; line-height:22px;">Daily Steps</p>
            <p class="reward-description" style="margin:0; font-size:14px; font-weight:600; line-height:18px;">Apr 12</p>
          </div>
          <div style="display:flex;justify-content:center;">
            <button style="background:#ffffff;color:#0d6fb8;border:none;border-radius:999px;padding:10px 22px;font-size:16px;font-weight:700;cursor:pointer;min-width:170px;text-align:center;">Redeem stamp</button>
          </div>
        </div>
        <div class="reward-card font-sans" data-reward-type="stamp" data-stamp-date="Apr 11" data-reward-code="MOVE10" style="flex:0 0 240px; background: linear-gradient(180deg, #8ed63a 0%, #5ca80a 100%); border-radius: 24px; padding: 22px 18px; color: #ffffff; box-shadow: none; scroll-snap-align:start; margin-bottom:10px;">
          <div style="display:flex;align-items:center;justify-content:center;margin-bottom:16px;">
            <div style="width:64px;height:64px;border-radius:50%;background:#ffffff;display:flex;align-items:center;justify-content:center;">
              <i class="fa-solid fa-shoe-prints reward-main-icon" style="font-size:28px;color:#2f6f0a;background:linear-gradient(135deg,#95DA39 0%,#2f6f0a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;"></i>
            </div>
          </div>
          <div style="text-align:center; margin-bottom:18px;">
            <p class="reward-title" style="margin:0 0 2px 0; font-size:18px; font-weight:700; line-height:22px;">Daily Steps</p>
            <p class="reward-description" style="margin:0; font-size:14px; font-weight:600; line-height:18px;">Apr 11</p>
          </div>
          <div style="display:flex;justify-content:center;">
            <button style="background:#ffffff;color:#0d6fb8;border:none;border-radius:999px;padding:10px 22px;font-size:16px;font-weight:700;cursor:pointer;min-width:170px;text-align:center;">Redeem stamp</button>
          </div>
        </div>
      </div>

    </section>

    <section class="mb-16">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <h2 class="section-title" style="font-size:20px;">Main Challenge</h2>
      </div>
        <article class="bg-white rounded-[32px] shadow-sm relative overflow-hidden border border-[#e5e5ea] mb-6" style="position:relative;">
          <div class="flex flex-col gap-1 pl-6 pr-6 pt-6 pb-3 relative card-header-safe">
            <p class="font-sans text-[13px] font-normal leading-[17px] text-[#8a8a93] uppercase tracking-[0.5px] mb-2">Entry Challenge</p>
            <p class="font-sans text-[22px] font-semibold leading-[28px] text-[#3a3a3c]">Allow activity permissions</p>
            <p class="font-sans text-[14px] font-normal leading-[18px] text-[#8a8a93]">
              Grant permissions to unlock your first 3 stamps instantly.
            </p>
            <span class="tag card-tag" style="position:absolute; top:16px; right:16px; border:0; padding:6px 10px; display:inline-flex; align-items:center; gap:6px; background:#e8f6db; color:#2f6f0a;">
              <i class="fa-solid fa-stamp" style="color:#2f6f0a;font-size:13px;"></i>
              3 stamps
            </span>
          </div>
          <div style="display:flex;justify-content:flex-start;padding:0 24px 18px;">
            <button style="background:#47850a;color:#ffffff;border:1px solid #47850a;border-radius:999px;padding:12px 18px;font-size:15px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:0 8px 18px rgba(53,107,9,0.25);" onclick="alert('Permissions requested. You will receive your first 3 stamps after granting access.'); const lock=document.getElementById('main-challenge-lock'); if(lock){lock.remove();}">
              <i class="fa-solid fa-check" style="font-size:14px;color:#ffffff;"></i>
              Give permissions
            </button>
          </div>
        </article>
        <!-- Card 2: Daily 5k Steps -->
        <article class="bg-white rounded-[32px] shadow-sm relative overflow-hidden border border-[#e5e5ea] mb-6" id="main-challenge-card">
          <div class="flex flex-col gap-1 pl-6 pr-6 pt-6 pb-3 relative card-header-safe">
            <p class="font-sans text-[13px] font-normal leading-[17px] text-[#8a8a93] uppercase tracking-[0.5px] mb-2">Daily Challenge</p>
            <p class="font-sans text-[22px] font-semibold leading-[28px] text-[#3a3a3c]">Hit 5,000 steps</p>
            <p class="font-sans text-[14px] font-normal leading-[18px] text-[#8a8a93]">
              Track your steps toward a 5,000-step daily goal to earn today's stamp.
            </p>
            <span class="tag card-tag" style="position:absolute; top:16px; right:16px; border:0; padding:6px 10px; display:inline-flex; align-items:center; gap:6px; background:#e8f6db; color:#2f6f0a;">
              <i class="fa-solid fa-stamp" style="color:#2f6f0a;font-size:13px;"></i>
              1 stamp
            </span>
          </div>
          <div class="relative h-[230px] overflow-hidden">
            <svg class="absolute top-[24px] h-[186px] w-[380px]" viewBox="0 0 380 210" preserveAspectRatio="xMaxYMid meet" fill="none" data-progress="64" style="overflow: visible; width:380px; right:0;">
              <defs>
                <linearGradient id="arcGreen" x1="51.5829" y1="-22.8751" x2="331.322" y2="-17.3927" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#95DA39" />
                  <stop offset="1" stop-color="#5DA20A" />
                </linearGradient>
                <linearGradient id="arcRed" x1="0" y1="22.5" x2="45" y2="22.5" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#E4002B" />
                  <stop offset="1" stop-color="#FD5553" />
                </linearGradient>
              </defs>
              <path d="M380 198H105C53.6375 198 12 156.362 12 105C12 53.6375 53.6375 12 105 12H380" stroke="#F2F2F7" stroke-width="20" />
              <path class="arc-progress" d="M380 198H105C53.6375 198 12 156.362 12 105C12 53.6375 53.6375 12 105 12H380" stroke="url(#arcGreen)" stroke-linecap="butt" stroke-width="20" pathLength="100" stroke-dasharray="0 100" />
              <circle class="arc-knob" r="20" fill="#E4002B" opacity="1" stroke="white" stroke-width="5" style="filter: drop-shadow(0 4px 12px rgba(0,0,0,0.18));"></circle>
              <text x="340" y="12" text-anchor="middle" dominant-baseline="middle" class="font-sans text-[12px]" fill="#6e6e73">5k</text>
              <text x="340" y="198" text-anchor="middle" dominant-baseline="middle" class="font-sans text-[12px]" fill="#ffffff" stroke="rgba(0,0,0,0.25)" stroke-width="0.4" paint-order="stroke">0</text>
            </svg>
            <div class="absolute top-[24px] h-[186px] w-[380px] flex items-center justify-center pointer-events-none" style="right:0;">
              <div class="text-center">
                <p class="font-sans text-[24px] font-semibold leading-[28px] text-[#3a3a3c] m-0">3,200 / 5,000</p>
                <p class="font-sans text-[13px] font-normal leading-[18px] text-[#8a8a93] m-0">steps today</p>
              </div>
            </div>
          </div>
          <div class="main-half-lock" id="main-challenge-lock">
            <button style="margin-bottom:8px;background:#47850a;color:#ffffff;border:1px solid #47850a;border-radius:999px;padding:12px 18px;font-size:15px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:0 8px 18px rgba(53,107,9,0.25);" onclick="alert('Permissions requested. You will receive your first 3 stamps after granting access.'); document.getElementById('main-challenge-lock')?.remove();">
              <i class="fa-solid fa-check" style="font-size:14px;color:#ffffff;"></i>
              Start challenge
            </button>
          </div>
        </article>

        <h3 class="section-title" style="font-size:18px;margin:0 0 12px 0;">Seasonal Challenges</h3>

        <!-- Card 6: Seasonal Nuance Steps -->
        <article class="bg-white rounded-[32px] shadow-sm relative overflow-hidden border border-[#e5e5ea] mb-6">
          <div class="flex flex-col gap-1 pl-6 pr-6 pt-6 pb-3 relative">
            <p class="font-sans text-[13px] font-normal leading-[17px] text-[#8a8a93] uppercase tracking-[0.5px] mb-2">Seasonal Â· Nuance</p>
            <p class="font-sans text-[22px] font-semibold leading-[28px] text-[#3a3a3c]">Nuance Spring Stride</p>
            <p class="font-sans text-[14px] font-normal leading-[18px] text-[#8a8a93]">
              Walk 25km this season with Nuance to unlock a Nuance cream reward.
            </p>
            <span class="tag" style="position:absolute; top:16px; right:16px; border:0; padding:6px 10px; display:inline-flex; align-items:center; gap:6px; background:#e8f6db; color:#2f6f0a; white-space:nowrap;">
              <i class="fa-solid fa-gift" style="color:#2f6f0a;font-size:13px;"></i>
              Nuance cream
            </span>
          </div>
          <div style="padding:20px 24px 24px; position:relative;">
              <div class="mobility-progress" data-progress="18" style="position:relative;height:20px;border-radius:999px;background:#f2f2f7;">
              <div class="mobility-progress-fill" style="height:100%;width:0%;background:linear-gradient(90deg, #95DA39 0%, #5DA20A 100%);border-radius:999px;"></div>
              <div class="mobility-progress-dot" style="position:absolute;left:4%;top:50%;transform:translate(-50%,-50%);width:40px;height:40px;border-radius:50%;background:#E4002B;border:4px solid #ffffff;box-shadow:0 4px 12px rgba(0,0,0,0.18);z-index:1;"></div>
              <span class="font-sans" style="position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:12px;color:#6e6e73;z-index:0;">0</span>
              <span class="font-sans" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:12px;color:#6e6e73;">25km</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;font-size:13px;color:#6e6e73;">
              <span class="font-sans">4.5 / 25 km</span>
              <span class="font-sans font-semibold" style="color:#3a3a3c;">18%</span>
            </div>
          </div>
          <div class="join-overlay" style="position:absolute;left:0;right:0;bottom:0;top:55%;display:flex;align-items:center;justify-content:flex-start;gap:12px;background:rgba(255,255,255,0.35);backdrop-filter:blur(4px);padding:12px 24px 24px;transition:opacity 0.35s ease;z-index:3;pointer-events:none;">
            <button class="join-overlay-btn" style="background:#47850a;color:#ffffff;border:1px solid #47850a;border-radius:999px;padding:12px 20px;font-size:15px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:0 8px 18px rgba(53,107,9,0.25);pointer-events:auto;">
              <i class="fa-solid fa-plus" style="font-size:14px;color:#ffffff;"></i>
              Join challenge
            </button>
          </div>
        </article>
      </div>
    </section>

  </main>

  <nav class="tabbar">
    <a class="tab" href="#">
      <div class="tab-icon"><img src="images/Home.svg" alt=""></div>
      <span>E-shop</span>
    </a>
    <a class="tab" href="#">
      <div class="tab-icon"><img src="images/Rx.svg" alt=""></div>
      <span>Prescription</span>
    </a>
    <a class="tab" href="#">
      <div class="tab-icon"><img src="images/Cart.svg" alt=""></div>
      <span>Cart</span>
    </a>
    <a class="tab" href="#">
      <div class="tab-icon"><img src="images/Purchases.svg" alt=""></div>
      <span>Purchases</span>
    </a>
    <a class="tab" href="app-home.html">
      <div class="tab-icon"><img src="images/Menu.svg" alt=""></div>
      <span>Home</span>
    </a>
  </nav>

  <div id="bonus-modal" class="bonus-modal" role="dialog" aria-modal="true" aria-labelledby="bonus-modal-title" aria-describedby="bonus-modal-desc">
    <div id="bonus-modal-overlay" class="bonus-modal__overlay"></div>
    <div class="bonus-modal__content glass">
      <div class="celebrate-icon">
        <i class="fa-solid fa-gift" style="font-size:30px;color:#ffffff;"></i>
      </div>
      <h3 id="bonus-modal-title">You did it!</h3>
      <p id="bonus-modal-desc">8 daily stamps collected. Enjoy a bonus reward for keeping your streak.</p>
      <div style="margin-bottom:8px;">
        <span class="bonus-code">
          MOVE10
          <button class="copy-code" data-code="MOVE10" aria-label="Copy code" style="background:transparent;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;">
            <i class="fa-solid fa-copy" style="font-size:14px;"></i>
          </button>
        </span>
      </div>
      <button id="bonus-modal-close" class="bonus-close">Save coupon for later</button>
    </div>
  </div>

  <script>
    // Animate arc progress when the card scrolls into view
    const easeOutCubic = (t) => 1 - Math.pow(1 - t, 3);

    const animateArc = (svg) => {
      const target = Math.max(0, Math.min(100, parseFloat(svg.dataset.progress || '0')));
      const path = svg.querySelector('.arc-progress');
      const knob = svg.querySelector('.arc-knob');
      if (!path || !knob || svg.dataset.animated === 'true') return;

      const totalLen = path.getTotalLength();
      const duration = 2200;
      const start = performance.now();

      const step = (now) => {
        const t = Math.min(1, (now - start) / duration);
        const eased = easeOutCubic(t);
        const current = target * eased;

        path.setAttribute('stroke-dasharray', `${current} ${100 - current}`);
        const point = path.getPointAtLength((current / 100) * totalLen);
        knob.setAttribute('cx', point.x);
        knob.setAttribute('cy', point.y);

        if (t < 1) {
          requestAnimationFrame(step);
        } else {
          svg.dataset.animated = 'true';
        }
      };

      // Init at zero and start
      path.setAttribute('stroke-dasharray', `0 100`);
      const startPoint = path.getPointAtLength(0);
      knob.setAttribute('cx', startPoint.x);
      knob.setAttribute('cy', startPoint.y);
      requestAnimationFrame(step);
    };

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            animateArc(entry.target);
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.25, rootMargin: '0px 0px -10% 0px' }
    );

    document.querySelectorAll('svg[data-progress]').forEach((svg) => {
      const path = svg.querySelector('.arc-progress');
      const knob = svg.querySelector('.arc-knob');
      if (path && knob) {
        // Reset to zero until animated
        path.setAttribute('stroke-dasharray', `0 100`);
        const startPoint = path.getPointAtLength(0);
        knob.setAttribute('cx', startPoint.x);
        knob.setAttribute('cy', startPoint.y);
        observer.observe(svg);
      }
    });

    // Animate straight mobility progress
    const animateStraight = (track) => {
      const target = Math.max(0, Math.min(100, parseFloat(track.dataset.progress || '0')));
      const fill = track.querySelector('.mobility-progress-fill');
      const dot = track.querySelector('.mobility-progress-dot');
      if (!fill || !dot || track.dataset.animated === 'true') return;

      const duration = 1800;
      const start = performance.now();

      const step = (now) => {
        const t = Math.min(1, (now - start) / duration);
        const eased = easeOutCubic(t);
        const current = target * eased;

        fill.style.width = `${current}%`;
        dot.style.left = `${current}%`;

        if (t < 1) {
          requestAnimationFrame(step);
        } else {
          track.dataset.animated = 'true';
        }
      };

      fill.style.width = '0%';
      dot.style.left = '0%';
      requestAnimationFrame(step);
    };

    const straightObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            animateStraight(entry.target);
            straightObserver.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.3, rootMargin: '0px 0px -10% 0px' }
    );

    document.querySelectorAll('.mobility-progress[data-progress]').forEach((track) => {
      const fill = track.querySelector('.mobility-progress-fill');
      const dot = track.querySelector('.mobility-progress-dot');
      if (fill && dot) {
        fill.style.width = '0%';
        dot.style.left = '0%';
        straightObserver.observe(track);
      }
    });

    const wireRewardActions = (root = document) => {
      root.querySelectorAll('.copy-code').forEach((copyBtn) => {
        if (copyBtn.dataset.wired === 'true') return;
        copyBtn.dataset.wired = 'true';
        copyBtn.addEventListener('click', (evt) => {
          evt.stopPropagation();
          const code = copyBtn.dataset.code || '';
          if (!code) return;
          navigator.clipboard?.writeText(code).catch(() => {});
          copyBtn.innerHTML = '<i class="fa-solid fa-check" style="font-size:14px;color:#0d6fb8;"></i>';
          setTimeout(() => {
            copyBtn.innerHTML = '<i class="fa-solid fa-copy" style="font-size:14px;"></i>';
          }, 1200);
        });
      });

      root.querySelectorAll('.add-to-cart-btn').forEach((addBtn) => {
        if (addBtn.dataset.wired === 'true') return;
        addBtn.dataset.wired = 'true';
        addBtn.addEventListener('click', (evt) => {
          evt.stopPropagation();
          addBtn.disabled = true;
          addBtn.innerHTML = '<i class="fa-solid fa-check" style="color:#0d6fb8;font-size:14px;"></i> Added to cart';
        });
      });
    };

    wireRewardActions();

    const unlockBonusReward = () => {
      const allStamps = Array.from(document.querySelectorAll('.stamps-row .stamp-dot'));
      if (allStamps.length === 0) return;
      const allFilled = allStamps.every((stamp) => stamp.classList.contains('stamp-dot-filled') || stamp.classList.contains('stamp-gift-active'));
      if (!allFilled) return;

      if (document.body.dataset.bonusPending === 'true') return;
      document.body.dataset.bonusPending = 'true';
      launchConfetti();
      openBonusModal();
    };


    const addStamp = () => {
      const stamps = Array.from(document.querySelectorAll('.stamps-row .stamp-dot:not(.stamp-dot-disabled)'));
      const next = stamps.find((stamp) => stamp && stamp.dataset.filled !== 'true');
      if (!next) {
        const gift = document.querySelector('.stamp-dot-disabled');
        if (gift) {
          gift.classList.add('stamp-gift-active');
          gift.querySelector('i')?.setAttribute('style', 'font-size:18px;color:#ffffff;');
        }
        unlockBonusReward();
        return;
      }
      next.dataset.filled = 'true';
      next.classList.add('stamp-dot-filled');
      if (!next.querySelector('i')) {
        const icon = document.createElement('i');
        icon.className = 'fa-solid fa-check stamp-icon';
        next.appendChild(icon);
      }
      next.classList.add('stamp-pop');
      setTimeout(() => next.classList.remove('stamp-pop'), 600);
      unlockBonusReward();
    };

    // Convert a reward card to claimed state when its button is clicked
    document.querySelectorAll('.reward-card button').forEach((btn) => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const card = btn.closest('.reward-card');
        if (!card || card.dataset.claimed === 'true') return;

        card.dataset.claimed = 'true';
        card.style.background = '#ffffff';
        card.style.border = '1px solid #e5e5ea';
        card.style.color = '#3a3a3c';
        card.style.transition = 'all 0.35s ease';
        card.animate(
          [
            { transform: 'scale(1)', boxShadow: card.style.boxShadow || 'none' },
            { transform: 'scale(1.03)', boxShadow: '0 8px 20px rgba(0,0,0,0.08)' },
            { transform: 'scale(1)', boxShadow: '0 6px 14px rgba(0,0,0,0.06)' }
          ],
          { duration: 320, easing: 'ease-out' }
        );

        const actions = btn.parentElement;
        if (actions) {
          const type = card.dataset.rewardType || 'code';
          if (type === 'product') {
            const productName = card.dataset.productName || 'Reward';
            actions.innerHTML = `
              <button class="add-to-cart-btn" style="background:#ffffff;color:#0d6fb8;border:1px solid #e5e5ea;border-radius:999px;padding:10px 18px;font-size:14px;font-weight:700;cursor:pointer;min-width:170px;text-align:center;display:inline-flex;align-items:center;gap:8px;justify-content:center;">
                <i class="fa-solid fa-cart-plus" style="color:#0d6fb8;font-size:14px;"></i>
                Add to cart
              </button>
            `;
          } else if (type === 'stamp') {
            const stampDate = card.dataset.stampDate ? ` ${card.dataset.stampDate}` : '';
            actions.innerHTML = `
              <button style="background:#eaf6dc;color:#2f6f0a;border:1px solid #d5e8b2;border-radius:999px;padding:10px 18px;font-size:14px;font-weight:700;cursor:default;min-width:170px;text-align:center;display:inline-flex;align-items:center;gap:8px;justify-content:center;">
                <i class="fa-solid fa-circle-check" style="font-size:14px;color:#2f6f0a;"></i>
                Claimed${stampDate ? ' - ' + stampDate : ''}
              </button>
            `;
          } else {
            const code = card.dataset.rewardCode || 'THANKS10';
            actions.innerHTML = `
              <span class="claim-code-pill" style="display:inline-flex;align-items:center;gap:10px; background:#ffffff; color:#0d6fb8; border:1px solid #e5e5ea; border-radius:999px; padding:10px 18px; font-size:14px; font-weight:700;min-width:170px;justify-content:center;">
                <span style="letter-spacing:0.6px;">${code}</span>
                <button class="copy-code" data-code="${code}" aria-label="Copy code" style="background:transparent;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#0d6fb8;">
                  <i class="fa-solid fa-copy" style="font-size:14px;"></i>
                </button>
              </span>
            `;
          }

          const pill = actions.querySelector('span,button');
          if (pill) {
            pill.style.opacity = '0';
            pill.style.transition = 'opacity 0.35s ease';
            requestAnimationFrame(() => {
              pill.style.opacity = '1';
            });
          }

          wireRewardActions(actions);
        }

        const icon = card.querySelector('.reward-main-icon');
        if (icon) {
          // keep same icon but invert styling: green gradient background, white icon
          icon.style.background = 'none';
          icon.style.webkitTextFillColor = '#ffffff';
          icon.style.color = '#ffffff';
          icon.style.fontSize = '26px';
          const iconWrap = icon.parentElement;
        if (iconWrap) iconWrap.style.background = 'linear-gradient(180deg, #95DA39 0%, #5DA20A 100%)';
        }

        addStamp();
      });
    });

    // Breathing coach start handler with 4-4-4-4 timing and matching bubble scales
    const breathPhases = [
      { label: 'Inhale', duration: 4000, scale: 1.1, transition: 4000 },
      { label: 'Hold', duration: 4000, scale: 1.1, transition: 0 },
      { label: 'Exhale', duration: 4000, scale: 0.9, transition: 4000 },
      { label: 'Hold', duration: 4000, scale: 0.9, transition: 0 }
    ];
    let breathTimeout;
    let breathSessionInterval;
    let totalDuration = 60000; // default 1 min
    let selectedDuration = 1;
    let isQuickMode = false;
    const breathBtn = document.getElementById('breathing-start');
    const breathBubble = document.getElementById('breathing-bubble');
    const breathLabel = document.getElementById('breathing-label');
    const breathStatus = document.getElementById('breathing-status');
    const breathCounter = document.getElementById('breathing-counter');

    const setBubbleScale = (scale, ms) => {
      if (!breathBubble) return;
      breathBubble.style.transition = `transform ${ms}ms ease-in-out`;
      breathBubble.style.transform = `scale(${scale})`;
    };

    const renderRestControls = () => {
      const controls = document.getElementById('breath-controls');
      if (!controls) return;
      controls.innerHTML = `
        <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;">
          <button class="breath-duration" data-duration="1" style="background:#ffffff;color:#1d73c5;border:1px solid #d7dce5;border-radius:999px;padding:10px 18px;font-size:14px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:0 1px 3px rgba(0,0,0,0.08);">1 min</button>
          <button class="breath-duration" data-duration="5" style="background:#ffffff;color:#1d73c5;border:1px solid #d7dce5;border-radius:999px;padding:10px 18px;font-size:14px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:0 1px 3px rgba(0,0,0,0.08);">5 min</button>
          <button class="breath-duration" data-duration="10" style="background:#ffffff;color:#1d73c5;border:1px solid #d7dce5;border-radius:999px;padding:10px 18px;font-size:14px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:0 1px 3px rgba(0,0,0,0.08);">10 min</button>
        </div>
        <div style="display:flex;justify-content:center;margin-top:8px;gap:8px;flex-wrap:wrap;">
          <button id="breathing-quick" style="background:#1d73c5;color:#ffffff;border:1px solid #1d73c5;border-radius:999px;padding:10px 18px;font-size:14px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:0 1px 3px rgba(0,0,0,0.08);">
            <i class="fa-solid fa-bolt" style="font-size:13px;color:#ffffff;"></i>
            Quick start
          </button>
        </div>
      `;
      const durationBtns = Array.from(controls.querySelectorAll('.breath-duration'));
      const highlight = (activeBtn) => {
        durationBtns.forEach((b) => {
          const isActive = b === activeBtn;
          b.style.background = isActive ? '#1d73c5' : '#ffffff';
          b.style.color = isActive ? '#ffffff' : '#1d73c5';
          b.style.borderColor = isActive ? '#1d73c5' : '#d7dce5';
          const icon = b.querySelector('i');
          if (icon) icon.style.color = b.style.color;
        });
      };
      durationBtns.forEach((btn) => {
        btn.addEventListener('click', () => {
          const mins = parseInt(btn.dataset.duration || '1', 10);
          selectedDuration = Math.max(1, mins);
          highlight(btn);
        });
      });
      highlight(durationBtns[0]);
      const quickBtn = document.getElementById('breathing-quick');
      if (quickBtn) {
        quickBtn.addEventListener('click', () => {
          isQuickMode = true;
          totalDuration = Number.POSITIVE_INFINITY;
          startBreathing();
        });
      }
      // Allow tapping a duration to start as well if desired
      durationBtns.forEach((btn) => {
        btn.addEventListener('dblclick', () => {
          const mins = parseInt(btn.dataset.duration || '1', 10);
          selectedDuration = Math.max(1, mins);
          highlight(btn);
          isQuickMode = false;
          totalDuration = selectedDuration * 60000;
          startBreathing();
        });
      });
    };

    const renderActiveControls = () => {
      const controls = document.getElementById('breath-controls');
      if (!controls) return;
      controls.innerHTML = `
        <span id="breathing-duration-display" style="font-size:14px;font-weight:700;color:#3a3a3c;">${isQuickMode ? 'On-going' : `${Math.round(totalDuration / 1000)}s remaining`}</span>
        <button id="breathing-stop" style="background:#e4002b;color:#fff;border:1px solid #e4002b;border-radius:999px;padding:10px 14px;font-size:13px;font-weight:700;cursor:pointer;">Stop</button>
      `;
      const stop = document.getElementById('breathing-stop');
      if (stop) stop.addEventListener('click', resetBreathing);
    };

    const startBreathing = () => {
      let phaseIndex = 0;
      setBubbleScale(0.9, 0);
      const sessionStart = performance.now();
      const sessionEnd = isQuickMode ? Number.POSITIVE_INFINITY : sessionStart + totalDuration;
      renderActiveControls();
      const runPhase = () => {
        const elapsed = performance.now() - sessionStart;
        if (!isQuickMode && elapsed >= totalDuration) {
          clearTimeout(breathTimeout);
          clearInterval(breathSessionInterval);
          if (breathLabel) breathLabel.textContent = 'Done';
          if (breathCounter) breathCounter.textContent = '';
          setBubbleScale(0.9, 300);
          return;
        }
        const phase = breathPhases[phaseIndex % breathPhases.length];
        setBubbleScale(phase.scale, phase.transition);
        if (breathLabel) breathLabel.textContent = phase.label;
        const seconds = phase.duration / 1000;
        let remaining = seconds;
        if (breathStatus) breathStatus.textContent = `${phase.label} (${seconds}s)`;
        if (breathCounter) breathCounter.textContent = remaining.toString();

        const tick = () => {
          remaining -= 1;
          if (remaining > 0) {
            if (breathCounter) breathCounter.textContent = remaining.toString();
            setTimeout(tick, 1000);
          }
        };
        setTimeout(tick, 1000);

        breathTimeout = setTimeout(() => {
          phaseIndex += 1;
          runPhase();
        }, phase.duration);
      };
      clearTimeout(breathTimeout);
      clearInterval(breathSessionInterval);
      const disp = document.getElementById('breathing-duration-display');
      const display = () => {
        if (isQuickMode) {
          if (disp) disp.textContent = 'On-going';
          return;
        }
        const remainingMs = sessionEnd - performance.now();
        const remainingSec = Math.max(0, Math.ceil(remainingMs / 1000));
        if (disp) {
          const mins = Math.floor(remainingSec / 60);
          const secs = remainingSec % 60;
          disp.textContent = mins > 0 ? `${mins}:${secs.toString().padStart(2, '0')} remaining` : `${secs}s remaining`;
        }
      };
      display();
      breathSessionInterval = setInterval(display, 1000);
      const stopBtn = document.getElementById('breathing-stop');
      if (stopBtn) stopBtn.style.display = 'inline-flex';
      const controls = document.getElementById('breath-controls');
      if (controls) controls.classList.add('breathing-active');
      runPhase();
    };

    const resetBreathing = () => {
      clearTimeout(breathTimeout);
      clearInterval(breathSessionInterval);
      setBubbleScale(0.9, 300);
      if (breathLabel) breathLabel.textContent = 'Tap start';
      if (breathCounter) breathCounter.textContent = '4';
      isQuickMode = false;
      renderRestControls();
    };

    renderRestControls();

    const launchConfetti = () => {
      const colors = ['#95DA39', '#5DA20A', '#E4002B', '#3997dd'];
      for (let i = 0; i < 28; i += 1) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.background = colors[i % colors.length];
        const startX = Math.random() * window.innerWidth;
        piece.style.left = `${startX}px`;
        piece.style.top = `${window.scrollY + 20}px`;
        piece.style.setProperty('--x', `${(Math.random() - 0.5) * 120}px`);
        piece.style.animationDelay = `${Math.random() * 0.1}s`;
        piece.style.transform = `rotate(${Math.random() * 360}deg)`;
        document.body.appendChild(piece);
        setTimeout(() => piece.remove(), 1300);
      }
    };

    const addBonusCard = (withAnimation = true) => {
      const carousel = document.querySelector('.rewards-carousel');
      if (!carousel || carousel.dataset.bonusAdded === 'true') return;
      carousel.dataset.bonusAdded = 'true';
      document.body.dataset.bonusPending = 'done';

      const card = document.createElement('div');
      card.className = 'reward-card font-sans';
      card.dataset.rewardType = 'code';
      card.dataset.rewardCode = 'MOVE10';
      card.style.cssText = 'flex:0 0 240px; background:#ffffff; border:1px solid #e5e5ea; border-radius:24px; padding:22px 18px; color:#3a3a3c; box-shadow:none; scroll-snap-align:start; margin-bottom:10px; position:relative; z-index:5;';
      card.innerHTML = `
        <div style="display:flex;align-items:center;justify-content:center;margin-bottom:16px;">
          <div style="width:64px;height:64px;border-radius:50%;background:linear-gradient(180deg, #95DA39 0%, #5DA20A 100%);display:flex;align-items:center;justify-content:center;">
            <i class="fa-solid fa-gift reward-main-icon" style="font-size:24px;color:#ffffff;"></i>
          </div>
        </div>
        <div style="text-align:center; margin-bottom:18px;">
          <p class="reward-title" style="margin:0 0 2px 0; font-size:18px; font-weight:700; line-height:22px;">Bonus Reward</p>
          <p class="reward-description" style="margin:0; font-size:14px; font-weight:600; line-height:18px; color:#6e6e73;">10% off your next order</p>
        </div>
        <div style="display:flex;justify-content:center;">
          <span class="claim-code-pill" style="display:inline-flex;align-items:center;gap:10px; background:#ffffff; color:#0d6fb8; border:1px solid #e5e5ea; border-radius:999px; padding:10px 18px; font-size:14px; font-weight:700;min-width:170px;justify-content:center;">
            <span style="letter-spacing:0.6px;">MOVE10</span>
            <button class="copy-code" data-code="MOVE10" aria-label="Copy code" style="background:transparent;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#0d6fb8;">
              <i class="fa-solid fa-copy" style="font-size:14px;"></i>
            </button>
          </span>
        </div>
      `;

      if (carousel.firstElementChild) {
        carousel.insertBefore(card, carousel.firstElementChild);
      } else {
        carousel.appendChild(card);
      }
      if (withAnimation) {
        card.style.opacity = '0';
        card.style.transform = 'translateY(16px) scale(0.97)';
        carousel.classList.add('reveal-card');
        requestAnimationFrame(() => {
          card.classList.add('bonus-card-pop', 'bonus-card-highlight');
          card.style.opacity = '';
          card.style.transform = '';
          setTimeout(() => {
            card.classList.remove('bonus-card-highlight');
            carousel.classList.remove('reveal-card');
          }, 1400);
        });
      }
      wireRewardActions(carousel);
    };

    const scrollCarouselToStart = (carousel) => {
      if (!carousel) return;
      const maxScroll = Math.max(0, carousel.scrollWidth - carousel.clientWidth);
      const start = Math.min(maxScroll, Math.max(carousel.scrollLeft, Math.min(maxScroll, 480)));
      carousel.scrollLeft = start;
      const duration = 2000;
      const begin = performance.now();
      const ease = (t) => 1 - Math.cos((t * Math.PI) / 2);
      carousel.classList.add('scrolling-to-start');
      const step = (now) => {
        const t = Math.min(1, (now - begin) / duration);
        const eased = ease(t);
        carousel.scrollLeft = start + (0 - start) * eased;
        if (t < 1) {
          requestAnimationFrame(step);
        } else {
          carousel.classList.remove('scrolling-to-start');
        }
      };
      requestAnimationFrame(step);
    };

    const resetStamps = () => {
      const stamps = document.querySelectorAll('.stamps-row .stamp-dot');
      const card = document.querySelector('.stamps-card');
      if (card) {
        card.classList.remove('turning');
        void card.offsetWidth;
        card.classList.add('turning');
      }
      setTimeout(() => {
        stamps.forEach((stamp) => {
          stamp.dataset.filled = '';
          stamp.classList.remove('stamp-dot-filled', 'stamp-gift-active', 'stamp-pop');
          if (!stamp.classList.contains('stamp-dot-disabled')) {
            stamp.querySelectorAll('i').forEach((icon) => icon.remove());
          } else {
            const giftIcon = stamp.querySelector('i');
            if (giftIcon) giftIcon.setAttribute('style', 'font-size:18px;color:#c0c4ce;');
          }
        });
      }, 320);
    };

    let lastScrollY = 0;

    const openBonusModal = () => {
      const modal = document.getElementById('bonus-modal');
      if (!modal || modal.dataset.open === 'true') return;
      lastScrollY = window.scrollY || 0;
      modal.dataset.open = 'true';
      modal.classList.add('visible');
      document.body.classList.add('modal-open');
    };

    const closeBonusModal = () => {
      const modal = document.getElementById('bonus-modal');
      if (!modal || modal.dataset.open !== 'true') return;
      modal.dataset.open = 'false';
      modal.classList.remove('visible');
      document.body.classList.remove('modal-open');
      const carousel = document.querySelector('.rewards-carousel');
      if (carousel) carousel.scrollLeft = 0;
      setTimeout(() => addBonusCard(true), 800);
      resetStamps();
      requestAnimationFrame(() => {
        if (typeof lastScrollY === 'number') {
          window.scrollTo(0, lastScrollY);
        }
      });
    };

    document.getElementById('bonus-modal-close')?.addEventListener('click', closeBonusModal);
    document.getElementById('bonus-modal-overlay')?.addEventListener('click', closeBonusModal);

    // Handle join overlay dismissal with animation
    document.querySelectorAll('.join-overlay-btn').forEach((btn) => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const overlay = btn.closest('.join-overlay');
        if (overlay) {
          overlay.style.transition = 'transform 0.45s ease, opacity 0.45s ease, filter 0.45s ease';
          overlay.style.transform = 'translateY(30px) scale(0.96)';
          overlay.style.opacity = '0';
          overlay.style.filter = 'blur(2px)';
          setTimeout(() => {
            overlay.remove();
          }, 450);
        }
      });
    });
  </script>

  <script src="https://kit.fontawesome.com/2c7f1c6cae.js" crossorigin="anonymous"></script>
</body>
</html>
